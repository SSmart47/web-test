const firebaseConfig={apiKey:"AIzaSyCOIQr3REsBR9gTfPNo37uDiruxsLibrM8",authDomain:"testcontent-d38c2.firebaseapp.com",databaseURL:"https://testcontent-d38c2-default-rtdb.firebaseio.com",projectId:"testcontent-d38c2",storageBucket:"testcontent-d38c2.appspot.com",messagingSenderId:"958227719442",appId:"1:958227719442:web:bb8bd9dd4e8fde1a817fcb"};var Data;firebase.initializeApp(firebaseConfig);var username=localStorage.getItem("ss47_webtest_user_i"),_u_n_=localStorage.getItem("ss47_webtest_user_n");function JsonToList(e){var t=e,s=[];for(var n in t)s.push([n,t[n]]);return s}function _NewArray(e){for(var t=[],s=0;s<e.length;s++)t.push(e[s]);return t}function ToInteger(e){return e.charCodeAt(0)}function ToChar(e){return String.fromCharCode(parseInt(e))}function Encrypt(e){var t="";t+=e;for(var s="",n=0;n<t.length;n++)s+="%"+ToInteger(t[n]);return s}function Decode(e){var t="",s="";e+="%";for(var n=1;n<e.length;n++)"%"==e[n]?(t+=ToChar(s),s=""):s+=e[n];return t}function FixedSpace(e){var t="";if(0==e.length)return"";t+=e[0];for(var s=1;s<e.length;s++)e[s]==e[s-1]&&" "==e[s]?t+="&nbsp":t+=e[s];return t}function Fixed(e){for(var t=FixedSpace(e),s="",n=0;n<t.length;n++)"<"==t[n]?s+="&lt;":">"==t[n]?s+="&gt;":s+=t[n];return s}function IsEmpty(e){for(var t=0;t<e.length;t++)if(" "!=e[t])return!1;return!0}function FixedQID(e){var t="";for(t+=e;t.length<5;)t="0"+t;return t}function FixedJsonStr(e){for(var t="",s=0;s<e.length;s++)"\n"!=e[s]&&" "!=e[s]&&"\t"!=e[s]&&(t+=e[s]);return t}function _FixedQuestionNumber(e){var t="";for(t+=e;t.length<10;)t="0"+t;return t}function _Str(e){var t="";return t+=e}function UpdateTestList(){for(var e="",t=0,s=JsonToList(Data.users),n=0;n<s.length;n++)for(var r=parseInt(s[n][0]),a=s[n][1].nick,o=JsonToList(s[n][1]),i=0;i<o.length;i++){var u=o[i][0];if("cancreatetests"!=u&&"nick"!=u&&"questionnum"!=u){var c=o[i][0],l=o[i][1].config,_=JsonToList(o[i][1].questions).length,d=Fixed(Decode(l.testname)),m=Decode(l.time);"false"==_Str(Decode(l.intime))&&(m=""),e+='<tr><th scope="row">'+ ++t+"</th><td>"+Fixed(d)+'</td><td><button class="btn btn-dark" onclick="AboutFriend(\''+r+"')\">"+a+"</button></td>",e+="<td>",e+='<div class="btn-group">',e+='<button class="btn btn-success" onclick="OpenTest(\''+r+"', '"+c+"')\">Пройти тест</button>",e+='<button class="btn btn-secondary" onclick="SetTaskProperties(\''+d+"', '"+_+"', '"+m+'\')" data-toggle="modal" data-target="#taskProperties">Свойства</button>',e+='<button class="btn btn-primary" onclick="ShowTaskResults(\''+r+"', '"+c+'\')" data-toggle="modal" data-target="#taskResults">Результаты</button>',e+="</div>",e+="</td>",e+="</tr>"}}document.getElementById("id_all_tests").innerHTML=e}async function CheckUser(){await firebase.database().ref().get().then(e=>{if(e.exists()){if(null==(Data=e.val()).users[username])firebase.database().ref("users/"+username).set({nick:_u_n_,cancreatetests:"0",questionnum:"0"}),Data.users[username]={nick:_u_n_,cancreatetests:"0"};else{var t=Data.users[username];t.nick=_u_n_,firebase.database().ref("users/"+username).set(t),Data.users[username].nick=_u_n_}0!=parseInt(Data.users[username].cancreatetests)&&(document.getElementById("id_nav_list").innerHTML+='<li class="nav-item">\n        <a class="nav-link" href="#" onclick="Pressed_MyTests()">Мои Тесты</a>\n      </li>'),UpdateTestList()}else console.log("Server Error!")}).catch(e=>{alert("No Connection!"),console.error(e)})}function SetTaskProperties(e,t,s){document.getElementById("id_ct_testname").innerText=""+e,document.getElementById("id_ct_questionnum").innerText=""+t,document.getElementById("id_testtime").innerText=""==s?"нет":s+" (чч:мм)"}function Pressed_MyTests(){localStorage.setItem("ss47_webtest_user_i",username),localStorage.setItem("ss47_webtest_user_n",_u_n_),window.location="pages/mytests/mytests.html"}function Pressed_Leaders(){localStorage.setItem("ss47_webtest_user_i",username),localStorage.setItem("ss47_webtest_user_n",_u_n_),window.location="pages/leaders/leaders.html"}function OpenTest(e,t){localStorage.setItem("ss47_webtest_user_i",username),localStorage.setItem("ss47_webtest_user_n",_u_n_),localStorage.setItem("ss47_webtest_task_ui",e),localStorage.setItem("ss47_webtest_task_qi",t),window.location="pages/passtest/passtest.html"}function ShowTaskResults(e,t){var s="";if(null==Data.users[e][t].results);else{for(var n=[],r=[],a=[],o=JsonToList(Data.users[e][t].results),i=0;i<o.length;i++){var u=Data.users[o[i][0]].nick,c=o[i][1].maxscore;n.push(u),r.push(c),a.push(o[i][0])}for(i=0;i<r.length;i++)for(var l=i+1;l<r.length;l++)if(r[i]<r[l]){var _=parseInt(r[i]);r[i]=parseInt(r[l]),r[l]=parseInt(_);var d=_Str(n[i]);n[i]=_Str(n[l]),n[l]=_Str(d);var m=_Str(a[i]);a[i]=_Str(a[l]),a[l]=_Str(m)}for(i=0;i<n.length;i++)s+='<tr>\n\t\t\t<th scope="row">'+(i+1)+'</th>\n\t\t\t<td><button class="btn btn-dark" onclick="AboutFriend(\''+a[i]+"')\">"+n[i]+"</button></td>\n\t\t\t<td>"+r[i]+"</td>\n\t\t\t</tr>"}document.getElementById("id_task_res_place").innerHTML=s}function AboutFriend(e){localStorage.setItem("ss47_webtest_user_i",username),localStorage.setItem("ss47_webtest_user_n",_u_n_),localStorage.setItem("ss47_webtest_friend_i",e),window.location="pages/friend/friend.html"}document.getElementById("id_exit_uname").innerHTML=_u_n_,document.getElementById("id_users_name").innerHTML=_u_n_,CheckUser(),document.getElementById("id_btn_exit").onclick=function(){localStorage.setItem("ss47_webtest_user_i",""),localStorage.setItem("ss47_webtest_user_n","")};
