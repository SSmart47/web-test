const firebaseConfig={apiKey:"AIzaSyCOIQr3REsBR9gTfPNo37uDiruxsLibrM8",authDomain:"testcontent-d38c2.firebaseapp.com",databaseURL:"https://testcontent-d38c2-default-rtdb.firebaseio.com",projectId:"testcontent-d38c2",storageBucket:"testcontent-d38c2.appspot.com",messagingSenderId:"958227719442",appId:"1:958227719442:web:bb8bd9dd4e8fde1a817fcb"};var Data;firebase.initializeApp(firebaseConfig);var username=localStorage.getItem("ss47_webtest_user_i"),_u_n_=localStorage.getItem("ss47_webtest_user_n"),_fid=localStorage.getItem("ss47_webtest_friend_i"),_fname="";function JsonToList(t){var e=t,n=[];for(var r in e)n.push([r,e[r]]);return n}function _NewArray(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e}function ToInteger(t){return t.charCodeAt(0)}function ToChar(t){return String.fromCharCode(parseInt(t))}function Encrypt(t){var e="";e+=t;for(var n="",r=0;r<e.length;r++)n+="%"+ToInteger(e[r]);return n}function Decode(t){var e="",n="";t+="%";for(var r=1;r<t.length;r++)"%"==t[r]?(e+=ToChar(n),n=""):n+=t[r];return e}function FixedSpace(t){var e="";if(0==t.length)return"";e+=t[0];for(var n=1;n<t.length;n++)t[n]==t[n-1]&&" "==t[n]?e+="&nbsp":e+=t[n];return e}function Fixed(t){for(var e=FixedSpace(t),n="",r=0;r<e.length;r++)"<"==e[r]?n+="&lt;":">"==e[r]?n+="&gt;":n+=e[r];return n}function IsEmpty(t){for(var e=0;e<t.length;e++)if(" "!=t[e])return!1;return!0}function FixedQID(t){var e="";for(e+=t;e.length<5;)e="0"+e;return e}function FixedJsonStr(t){for(var e="",n=0;n<t.length;n++)"\n"!=t[n]&&" "!=t[n]&&"\t"!=t[n]&&(e+=t[n]);return e}function _FixedQuestionNumber(t){var e="";for(e+=t;e.length<10;)e="0"+e;return e}function _Str(t){var e="";return e+=t}function UpdateTestList(){for(var t="",e=0,n=JsonToList(Data.users),r=0;r<n.length;r++){var s=parseInt(n[r][0]),a=n[r][1].nick,o=JsonToList(n[r][1]);if(a==_fname)for(var i=0;i<o.length;i++){var c=o[i][0];if("cancreatetests"!=c&&"nick"!=c&&"questionnum"!=c){var u=o[i][0],l=o[i][1].config,d=JsonToList(o[i][1].questions).length,f=Fixed(Decode(l.testname)),_=Decode(l.time);"false"==_Str(Decode(l.intime))&&(_=""),t+='<tr><th scope="row">'+ ++e+"</th><td>"+f+'</td><td><button class="btn btn-dark">'+a+"</button></td>",t+="<td>",t+='<div class="btn-group">',t+='<button class="btn btn-success" onclick="OpenTest(\''+s+"', '"+u+"')\">Пройти тест</button>",t+='<button class="btn btn-secondary" onclick="SetTaskProperties(\''+f+"', '"+d+"', '"+_+'\')" data-toggle="modal" data-target="#taskProperties">Свойства</button>',t+='<button class="btn btn-primary" onclick="ShowTaskResults(\''+s+"', '"+u+'\')" data-toggle="modal" data-target="#taskResults">Результаты</button>',t+="</div>",t+="</td>",t+="</tr>"}}}document.getElementById("id_all_tests").innerHTML=t}async function CheckUser(){await firebase.database().ref().get().then(t=>{t.exists()?(Data=t.val(),_fname=_Str(Data.users[_fid].nick),document.getElementById("id_friend_name").innerText=_fname,UpdateTestList()):console.log("Server Error!")}).catch(t=>{alert("No Connection!"),console.error(t)})}function SetTaskProperties(t,e,n){document.getElementById("id_ct_testname").innerText=""+t,document.getElementById("id_ct_questionnum").innerText=""+e,document.getElementById("id_testtime").innerText=""==n?"нет":n+" (чч:мм)"}function OpenTest(t,e){localStorage.setItem("ss47_webtest_user_i",username),localStorage.setItem("ss47_webtest_user_n",_u_n_),localStorage.setItem("ss47_webtest_task_ui",t),localStorage.setItem("ss47_webtest_task_qi",e),window.location="../passtest/passtest.html"}function ShowTaskResults(t,e){var n="";if(null==Data.users[t][e].results);else{for(var r=[],s=[],a=JsonToList(Data.users[t][e].results),o=0;o<a.length;o++){var i=Data.users[a[o][0]].nick,c=a[o][1].maxscore;r.push(i),s.push(c)}for(o=0;o<s.length;o++)for(var u=o+1;u<s.length;u++)if(s[o]<s[u]){var l=parseInt(s[o]);s[o]=parseInt(s[u]),s[u]=parseInt(l);var d=_Str(r[o]);r[o]=_Str(r[u]),r[u]=_Str(d)}for(o=0;o<r.length;o++)n+='<tr>\n\t\t\t<th scope="row">'+(o+1)+"</th>\n\t\t\t<td>"+r[o]+"</td>\n\t\t\t<td>"+s[o]+"</td>\n\t\t\t</tr>"}document.getElementById("id_task_res_place").innerHTML=n}CheckUser(),document.getElementById("id_btn_back").onclick=function(){localStorage.setItem("ss47_webtest_user_i",username),localStorage.setItem("ss47_webtest_user_n",_u_n_),window.location="../../main.html"};
